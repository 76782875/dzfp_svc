<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rjxx.taxeasy.dao.FpzlMapper">

    <select id="findOneByParams" parameterType="map" resultType="fpzl">
        select * from t_fpzl where yxbz = '1'
        <if test="orderBy != null">
            order by #{orderBy}
        </if>
        limit 1
    </select>

    <select id="findAllByParams" parameterType="map" resultType="fpzl">
        select * from t_fpzl
        
    </select>

    <select id="findByPage" parameterType="pagination" resultType="fpzl">
        select * from t_fpzl where yxbz = '1'
        <if test="params.orderBy != null">
            order by #{params.orderBy}
        </if>
    </select>
    
    <select id="findGfpsl" parameterType="map" resultType="fpnum">
         select count(*) as fpnum from t_kpls where jshj&gt;0 and fphm is not null
         <if test="gsdm !=null and gsdm !=''">
            and gsdm = #{gsdm}
         </if>
         <if test="xfid !=null and xfid !=''">
            and xfid = #{xfid}
         </if>
         <if test="fpzl !=null and fpzl !=''">
            and fpzldm = #{fpzl}
         </if>
         <if test="kprq !=null and kprq != ''">
            and kprq like concat('%',#{kprq},'%')
         </if>
                union all select count(*) from t_kpls where jshj&lt;0 and fphm is not null 
                <if test="gsdm !=null and gsdm !=''">
            and gsdm = #{gsdm}
         </if>
         <if test="xfid !=null and xfid !=''">
            and xfid = #{xfid}
         </if>
         <if test="fpzl !=null and fpzl !=''">
            and fpzldm = #{fpzl}
         </if>
         <if test="kprq !=null and kprq != ''">
            and kprq like concat('%',#{kprq},'%')
         </if>
                union all select count(*) from t_kpls where fpczlxdm='11' and fphm is not null
                <if test="gsdm !=null and gsdm !=''">
            and gsdm = #{gsdm}
         </if>
         <if test="xfid !=null and xfid !=''">
            and xfid = #{xfid}
         </if>
         <if test="fpzl !=null and fpzl !=''">
            and fpzldm = #{fpzl}
         </if>
         <if test="kprq !=null and kprq != ''">
            and kprq like concat('%',#{kprq},'%')
         </if>
                union all select count(*) from t_kpls where fpczlxdm='12' and fpztdm ='00'
                <if test="gsdm !=null and gsdm !=''">
            and gsdm = #{gsdm}
         </if>
         <if test="xfid !=null and xfid !=''">
            and xfid = #{xfid}
         </if>
         <if test="fpzl !=null and fpzl !=''">
            and fpzldm = #{fpzl}
         </if>
         <if test="kprq !=null and kprq != ''">
            and kprq like concat('%',#{kprq},'%')
         </if>
                union all select count(*) from t_kpls where fpczlxdm='13' and fpztdm='00'
                <if test="gsdm !=null and gsdm !=''">
            and gsdm = #{gsdm}
         </if>
         <if test="xfid !=null and xfid !=''">
            and xfid = #{xfid}
         </if>
         <if test="fpzl !=null and fpzl !=''">
            and fpzldm = #{fpzl}
         </if>
         <if test="kprq !=null and kprq != ''">
            and kprq like concat('%',#{kprq},'%')
         </if>
                union all select count(*) from t_kpls where fpczlxdm='21' and fpztdm='00'
                <if test="gsdm !=null and gsdm !=''">
            and gsdm = #{gsdm}
         </if>
         <if test="xfid !=null and xfid !=''">
            and xfid = #{xfid}
         </if>
         <if test="fpzl !=null and fpzl !=''">
            and fpzldm = #{fpzl}
         </if>
         <if test="kprq !=null and kprq != ''">
            and kprq like concat('%',#{kprq},'%')
         </if>
                union all select count(*) from t_kpls where fpczlxdm='23' and fpztdm='00' 
                <if test="gsdm !=null and gsdm !=''">
            and gsdm = #{gsdm}
         </if>
         <if test="xfid !=null and xfid !=''">
            and xfid = #{xfid}
         </if>
         <if test="fpzl !=null and fpzl !=''">
            and fpzldm = #{fpzl}
         </if>
         <if test="kprq !=null and kprq != ''">
            and kprq like concat('%',#{kprq},'%')
         </if>
                union all select count(*) from t_kpls where fpczlxdm='24' and fpztdm='00'
         <if test="gsdm !=null and gsdm !=''">
            and gsdm = #{gsdm}
         </if>
         <if test="xfid !=null and xfid !=''">
            and xfid = #{xfid}
         </if>
         <if test="fpzl !=null and fpzl !=''">
            and fpzldm = #{fpzl}
         </if>
         <if test="kprq !=null and kprq != ''">
            and kprq like concat('%',#{kprq},'%')
         </if>
    </select>
    
    <select id="findSpsl" parameterType="map" resultType="kpspmx">
           select DISTINCT b.spsl from t_kpls a,t_kpspmx b where a.kplsh = b.kplsh
           <if test="gsdm !=null and gsdm !=''">
              and a.gsdm=#{gsdm}
           </if>
           <if test="xfid !=null and xfid !=''">
               and a.xfid = #{xfid}
           </if>
           <if test="fpzl !=null and fpzl !=''">
               and a.fpzldm = #{fpzl} 
           </if>
    </select>
    
    <select id="findSpje" parameterType="map" resultType="slcxvo">
         SELECT
	*
FROM
	(
		SELECT
      xfmc,
			fpzl,
			sl * 100 sl,
			CASE jzjtbz
		WHEN 1 THEN
			'即征即退'
		ELSE
			'普通'
		END jzjtbz,
		sum(zsje) zsje,
		sum(fsje) fsje,
		sum(hjje) hjje,
		sum(zsse) zsse,
		sum(fsse) fsse,
		sum(hjse) hjse
	FROM
		V_FSLMX
	WHERE 1=1
		<if test="gsdm !=null and gsdm !=''">
          and gsdm = #{gsdm}
      </if>
      <if test="xfid !=null and xfid !=''">
          and xfid = #{xfid}
      </if>
      <if test="fpzl !=null and fpzl !=''">
          and fpzldm = #{fpzl}
      </if>
      <if test="kprq !=null and kprq !=''">
          and kprq like concat('%',#{kprq},'%')
      </if>
	GROUP BY
	    xfmc,
		fpzl,
		sl * 100,
		CASE jzjtbz
	WHEN 1 THEN
		'即征即退'
	ELSE
		'普通'
	END WITH ROLLUP
	) t
WHERE
	(
		t.jzjtbz = '普通'
		OR t.jzjtbz = '即征即退'
	)
AND t.fpzl IS NOT NULL
AND t.sl IS NOT NULL
ORDER BY
	1,
	2,
	3;
    </select>
    
     <select id="findDbsx" parameterType="map" resultType="fpnum">
            select count(*) fpnum from t_jyxxsq where ztbz = '1' and yxbz='1' and gsdm= #{gsdm}
union all select count(*) from t_jyls where clztdm='01' and yxbz='1' and fpczlxdm='11' and gsdm= #{gsdm}
union all select count(*) from t_jyls where clztdm='01' and yxbz='1' and fpczlxdm='12' and gsdm= #{gsdm}
union all select count(*) from t_jyls where clztdm='01' and yxbz='1' and fpczlxdm='13' and gsdm= #{gsdm}
union all select count(*) from t_jyls where clztdm='01' and yxbz='1' and fpczlxdm='14' and gsdm= #{gsdm}
union all select count(*) from t_jyls where clztdm='01' and yxbz='1' and fpczlxdm='23' and gsdm= #{gsdm}
union all select count(*) from t_jyls where clztdm='01' and yxbz='1' and fpczlxdm='24' and gsdm= #{gsdm}
     </select>

</mapper>

